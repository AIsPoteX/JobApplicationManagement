{% extends 'jobs/base.html' %}

{% block content %}
<h2>Edit - {{ job.company_name }}</h2>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <div class="form-group">
        <label for="{{ form.company_name.id_for_label }}">{{ form.company_name.label }} *</label>
        {{ form.company_name }}
        {% if form.company_name.errors %}
            <div class="error">{{ form.company_name.errors }}</div>
        {% endif %}
    </div>
    
    <div class="form-group">
        <label for="{{ form.notes.id_for_label }}">{{ form.notes.label }} (less than 100 words)</label>
        {{ form.notes }}
        {% if form.notes.errors %}
            <div class="error">{{ form.notes.errors }}</div>
        {% endif %}
    </div>
    
    <div class="form-group">
        <label for="{{ form.pdf_file.id_for_label }}">{{ form.pdf_file.label }}</label>
        {{ form.pdf_file }}
        {% if form.pdf_file.errors %}
            <div class="error">{{ form.pdf_file.errors }}</div>
        {% endif %}
        <small class="help-text">{{ form.pdf_file.help_text }}</small>
        {% if job.pdf_file %}
            <div class="current-file">
                <p><a href="{{ job.pdf_file.url }}" target="_blank">{{ job.pdf_file.name }}</a></p>
            </div>
        {% endif %}
    </div>
    
    <div class="form-group">
        <button type="submit" class="btn">Refresh</button>
        <a href="{% url 'job_list' %}" class="btn" style="background-color: #6c757d; margin-left: 10px;">Cancel</a>
    </div>
</form>

<script>
// 显示备注字符计数
document.getElementById('{{ form.notes.id_for_label }}').addEventListener('input', function() {
    const maxLength = 100;
    const currentLength = this.value.length;
    const label = this.previousElementSibling;
    
    if (!label.querySelector('.char-count')) {
        const span = document.createElement('span');
        span.className = 'char-count';
        span.style.color = '#666';
        span.style.fontSize = '12px';
        label.appendChild(span);
    }
    
    const countSpan = label.querySelector('.char-count');
    countSpan.textContent = ` (${currentLength}/${maxLength})`;
    
    if (currentLength > maxLength * 0.8) {
        countSpan.style.color = '#dc3545';
    } else {
        countSpan.style.color = '#666';
    }
});

// 页面加载时初始化字符计数
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('{{ form.notes.id_for_label }}').dispatchEvent(new Event('input'));
});
</script>
{% endblock %}
